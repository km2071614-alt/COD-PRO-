<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>COD PRO | Private Admin Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #1a237e; --accent: #ff6d00; --bg: #f0f2f5; --white: #ffffff; --text-main: #1e293b; --text-sub: #64748b; }
        [data-theme="dark"] { --primary: #818cf8; --accent: #fbbf24; --bg: #020617; --white: #1e293b; --text-main: #f1f5f9; --text-sub: #94a3b8; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text-main); overflow-x: hidden; padding-bottom: 85px; transition: 0.3s; }

        /* شاشة الدخول الزجاجية */
        #auth-page { position: fixed; inset: 0; background: linear-gradient(135deg, #1a237e, #000); display: flex; align-items: center; justify-content: center; z-index: 5000; padding: 20px; }
        .glass-card { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.2); border-radius: 35px; padding: 35px 25px; width: 100%; max-width: 380px; text-align: center; color: white; }
        
        .header-app { padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; background: var(--bg); position: sticky; top: 0; z-index: 100; }
        .logo-icon { width: 35px; height: 35px; background: linear-gradient(45deg, var(--accent), #ff9100); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; margin-left: 10px; font-family: monospace; }

        .page { display: none; padding: 15px 5%; animation: slideUp 0.4s ease; }
        .page.active { display: block; }
        .card { background: var(--white); border-radius: 25px; padding: 20px; margin-bottom: 15px; border: 1px solid rgba(0,0,0,0.05); position: relative; }
        .welcome-card { background: var(--primary); color: white; overflow: hidden; }

        /* المربعات الطائرة */
        .sq { position: absolute; background: rgba(255,255,255,0.1); animation: fly 10s infinite linear; bottom: -50px; }
        @keyframes fly { from { transform: translateY(0) rotate(0); } to { transform: translateY(-500px) rotate(360deg); } }

        .bottom-nav { position: fixed; bottom: 0; width: 100%; height: 75px; background: var(--white); display: flex; justify-content: space-around; align-items: center; box-shadow: 0 -5px 20px rgba(0,0,0,0.05); z-index: 1000; }
        .nav-tab { color: var(--text-sub); display: flex; flex-direction: column; align-items: center; font-size: 11px; font-weight: 700; cursor: pointer; }
        .nav-tab.active { color: var(--primary); }
        .nav-tab.admin-only { display: none; color: #ef4444; } /* مخفي افتراضياً */

        .btn-accent { width: 100%; padding: 15px; background: var(--accent); color: white; border: none; border-radius: 15px; font-weight: 900; cursor: pointer; }
        .input-st { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #ddd; margin-bottom: 10px; background: var(--bg); color: var(--text-main); }
        .input-glass { width: 100%; padding: 15px; background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.2); border-radius: 15px; color: white; margin-bottom: 12px; text-align: center; }

        .full-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 4000; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        video { width: 100%; border-radius: 15px; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body onload="checkLogin();">

    <div id="auth-page">
        <div id="login-box" class="glass-card">
            <div class="logo-icon" style="margin: 0 auto 20px; width: 60px; height: 60px; font-size: 30px;">&lt;/&gt;</div>
            <h2>تسجيل الدخول</h2>
            <p style="font-size: 13px; opacity: 0.7; margin-bottom: 25px;">ادخل بياناتك للمتابعة</p>
            <input type="text" id="log-name" class="input-glass" placeholder="الاسم">
            <input type="email" id="log-email" class="input-glass" placeholder="البريد الإلكتروني">
            <button class="btn-accent" onclick="handleLogin()">دخول</button>
            <p style="margin-top: 15px; font-size: 12px; opacity: 0.5;">Engineer Karem Mohamed</p>
        </div>
    </div>

    <div id="app-content" style="display: none;">
        <header class="header-app">
            <div style="display:flex; align-items:center; font-weight:900; color:var(--primary);"><div class="logo-icon">&lt;/&gt;</div>COD PRO</div>
            <i class="fas fa-moon" onclick="toggleTheme()"></i>
        </header>

        <div id="home" class="page active">
            <div class="card welcome-card">
                <div class="sq" style="left:10%; width:30px; height:30px;"></div>
                <div class="sq" style="left:80%; width:20px; height:20px; animation-delay:2s;"></div>
                <h2 id="user-welcome">أهلاً بك</h2>
                <p>جاهز لتعلم شيء جديد اليوم؟</p>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <div class="card" style="text-align: center;"><small>الدروس</small><h2 id="st-done" style="color:var(--accent)">0</h2></div>
                <div class="card" style="text-align: center;"><small>الإنجاز</small><h2 id="st-prog" style="color:var(--accent)">0%</h2></div>
            </div>
        </div>

        <div id="lessons" class="page">
            <h3>المسار التعليمي</h3>
            <div id="lesson-list" style="margin-top:15px;"></div>
        </div>

        <div id="admin-panel" class="page">
            <h3 style="color:#ef4444; margin-bottom:15px;"><i class="fas fa-user-shield"></i> لوحة تحكم المدير</h3>
            <div class="card">
                <input type="text" id="adm-title" class="input-st" placeholder="عنوان الدرس">
                <input type="text" id="adm-url" class="input-st" placeholder="رابط الفيديو (Direct Link)">
                <select id="adm-type" class="input-st">
                    <option value="free">مجاني</option>
                    <option value="paid">مدفوع (بكود)</option>
                </select>
                <input type="text" id="adm-code" class="input-st" placeholder="كود التفعيل (للمدفوع فقط)">
                <button class="btn-accent" onclick="addNewLesson()">إضافة الدرس فوراً</button>
            </div>
            <div id="admin-lessons-list"></div>
        </div>

        <div id="profile" class="page">
            <div class="card" style="text-align: center;">
                <div style="width:60px; height:60px; background:var(--primary); color:white; border-radius:50%; display:flex; align-items:center; justify-content:center; margin: 0 auto 15px; font-size:25px;"><i class="fas fa-user"></i></div>
                <h3 id="p-name">--</h3>
                <p id="p-email" style="margin-bottom: 20px; opacity:0.6"></p>
                <div id="admin-btn-profile" style="display:none; margin-bottom:10px;">
                    <button onclick="showTab(null, 'admin-panel')" style="background:#ef4444; color:white; border:none; padding:10px; border-radius:10px; width:100%;">فتح لوحة الإدارة</button>
                </div>
                <button onclick="logout()" style="color:red; background:none; border:none; font-weight:bold;">خروج</button>
            </div>
        </div>

        <nav class="bottom-nav">
            <div class="nav-tab active" onclick="showTab(this, 'home')"><i class="fas fa-home"></i><span>الرئيسية</span></div>
            <div class="nav-tab" onclick="showTab(this, 'lessons')"><i class="fas fa-play"></i><span>الدروس</span></div>
            <div id="admin-tab" class="nav-tab admin-only" onclick="showTab(this, 'admin-panel')"><i class="fas fa-tools"></i><span>الإدارة</span></div>
            <div class="nav-tab" onclick="showTab(this, 'profile')"><i class="fas fa-user"></i><span>حسابي</span></div>
        </nav>
    </div>

    <div id="video-overlay" class="full-overlay">
        <div id="pay-section" style="display:none; text-align:center; color:white;">
            <i class="fas fa-lock" style="font-size: 50px; color: var(--accent); margin-bottom: 20px;"></i>
            <h3>محتوى مقفل</h3>
            <input type="text" id="act-code" class="input-glass" placeholder="أدخل كود التفعيل">
            <button class="btn-accent" onclick="verifyCode()">تفعيل</button>
            <p onclick="closeVid()" style="margin-top:20px; opacity:0.5;">إغلاق</p>
        </div>
        <div id="video-section" style="display:none; width:100%;">
            <div style="display:flex; justify-content:space-between; color:white; margin-bottom:10px;">
                <strong id="v-title">الدرس</strong><i class="fas fa-times" onclick="closeVid()"></i>
            </div>
            <video id="player" controls playsinline></video>
        </div>
    </div>

    <script>
        let currentUser = null;
        let pendingLesson = null;
        const ADMIN_KEY = "ppooos"; // الرمز السري بتاعك

        function handleLogin() {
            const name = document.getElementById('log-name').value;
            const email = document.getElementById('log-email').value;

            if(!name || !email) return alert("اكتب بياناتك");

            const user = { name, email, isAdmin: (name === ADMIN_KEY && email === ADMIN_KEY) };
            localStorage.setItem('activeUser', JSON.stringify(user));
            checkLogin();
        }

        function checkLogin() {
            const user = localStorage.getItem('activeUser');
            if(user) {
                currentUser = JSON.parse(user);
                document.getElementById('auth-page').style.display = 'none';
                document.getElementById('app-content').style.display = 'block';
                document.getElementById('user-welcome').innerText = `أهلاً، ${currentUser.name}`;
                document.getElementById('p-name').innerText = currentUser.name;
                document.getElementById('p-email').innerText = currentUser.email;

                if(currentUser.isAdmin) {
                    document.getElementById('admin-tab').style.display = 'flex';
                    document.getElementById('admin-btn-profile').style.display = 'block';
                }
                renderLessons();
            }
        }

        function renderLessons() {
            const lessons = JSON.parse(localStorage.getItem('codpro_database') || '[]');
            const list = document.getElementById('lesson-list');
            const admList = document.getElementById('admin-lessons-list');

            list.innerHTML = lessons.map(l => `
                <div class="card" onclick="openLesson('${l.id}')">
                    <div style="display:flex; align-items:center; gap:15px;">
                        <i class="fas fa-play-circle" style="font-size:30px; color:var(--primary)"></i>
                        <div style="flex:1"><strong>${l.title}</strong></div>
                        ${l.type === 'paid' ? '<i class="fas fa-lock" style="color:var(--accent)"></i>' : ''}
                    </div>
                </div>
            `).join('');

            if(currentUser.isAdmin) {
                admList.innerHTML = lessons.map(l => `
                    <div class="card" style="border-right:5px solid red;">
                        <strong>${l.title}</strong>
                        <button onclick="deleteLesson('${l.id}')" style="float:left; color:red; border:none; background:none;">حذف</button>
                    </div>
                `).join('');
            }
        }

        function addNewLesson() {
            const title = document.getElementById('adm-title').value;
            const url = document.getElementById('adm-url').value;
            const type = document.getElementById('adm-type').value;
            const code = document.getElementById('adm-code').value;

            if(!title || !url) return alert("اكمل البيانات");

            let lessons = JSON.parse(localStorage.getItem('codpro_database') || '[]');
            lessons.push({ id: Date.now().toString(), title, url, type, code });
            localStorage.setItem('codpro_database', JSON.stringify(lessons));
            
            alert("تم إضافة الدرس بنجاح!");
            renderLessons();
        }

        function deleteLesson(id) {
            let lessons = JSON.parse(localStorage.getItem('codpro_database') || '[]');
            lessons = lessons.filter(l => l.id !== id);
            localStorage.setItem('codpro_database', JSON.stringify(lessons));
            renderLessons();
        }

        function openLesson(id) {
            const lessons = JSON.parse(localStorage.getItem('codpro_database') || '[]');
            const lesson = lessons.find(l => l.id === id);
            pendingLesson = lesson;
            
            document.getElementById('video-overlay').style.display = 'flex';
            if(lesson.type === 'paid') {
                document.getElementById('pay-section').style.display = 'block';
                document.getElementById('video-section').style.display = 'none';
            } else {
                startVid();
            }
        }

        function verifyCode() {
            if(document.getElementById('act-code').value === pendingLesson.code) {
                startVid();
            } else alert("كود خاطئ");
        }

        function startVid() {
            document.getElementById('pay-section').style.display = 'none';
            document.getElementById('video-section').style.display = 'block';
            const p = document.getElementById('player');
            p.src = pendingLesson.url;
            document.getElementById('v-title').innerText = pendingLesson.title;
            p.play();
        }

        function closeVid() { document.getElementById('player').pause(); document.getElementById('video-overlay').style.display = 'none'; }

        function showTab(btn, id) {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            if(btn) btn.classList.add('active');
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function toggleTheme() {
            const isDark = document.body.getAttribute('data-theme') === 'dark';
            document.body.setAttribute('data-theme', isDark ? 'light' : 'dark');
        }

        function logout() { localStorage.removeItem('activeUser'); location.reload(); }
    </script>
</body>
</html>
            <p style="font-size: 13px; opacity: 0.7; margin-bottom: 25px;">انضم إلى مجتمع COD PRO</p>
            <input type="text" id="reg-name" class="input-glass" placeholder="الاسم الكامل">
            <input type="email" id="reg-email" class="input-glass" placeholder="البريد الإلكتروني">
            <button class="btn-accent" onclick="doSignup()">تسجيل حساب جديد</button>
            <p style="margin-top: 20px; font-size: 13px;">لديك حساب بالفعل؟ <span onclick="switchAuth('login')" style="color:var(--accent); font-weight:bold; cursor:pointer;">تسجيل دخول</span></p>
        </div>
    </div>

    <div id="app-content" style="display: none;">
        <header class="header-app">
            <div class="logo-mobile"><div class="logo-icon">&lt;/&gt;</div>COD<span>PRO</span></div>
            <i class="fas fa-moon" onclick="toggleTheme()" id="theme-icon"></i>
        </header>

        <div id="home" class="page active">
            <div class="card welcome-card">
                <div class="sq-anim">
                    <span style="left:10%; width:30px; height:30px;"></span>
                    <span style="left:80%; width:20px; height:20px; animation-delay: 2s;"></span>
                </div>
                <h2 id="user-welcome">مرحباً</h2>
                <p style="opacity: 0.8;">استعد لرحلة برمجية ممتعة اليوم.</p>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <div class="card" style="text-align: center;"><small>الدروس</small><h2 id="st-done" style="color:var(--accent)">0</h2></div>
                <div class="card" style="text-align: center;"><small>الإنجاز</small><h2 id="st-prog" style="color:var(--accent)">0%</h2></div>
            </div>

            <div style="text-align:center; margin-top:50px; opacity:0.04;">
                <i class="fas fa-code" style="font-size: 80px;"></i>
                <h1 style="letter-spacing: 10px;">COD PRO</h1>
            </div>
        </div>

        <div id="lessons" class="page">
            <h3 style="margin-bottom: 15px;">المسار التعليمي</h3>
            <div id="lesson-list"></div>
        </div>

        <div id="forum" class="page">
            <h3 style="margin-bottom: 15px;">مجتمع المبرمجين</h3>
            <div class="card" style="padding: 10px;">
                <textarea id="post-text" placeholder="بماذا تفكر؟" style="width:100%; border:none; background:var(--bg); padding:10px; border-radius:10px; height:60px; resize:none;"></textarea>
                <button class="btn-accent" style="margin-top:10px; padding:10px;" onclick="addPost()">نشر</button>
            </div>
            <div id="forum-posts"></div>
        </div>

        <div id="profile" class="page">
            <div class="card" style="text-align: center; padding: 40px 20px;">
                <div style="width:70px; height:70px; background:var(--primary); color:white; border-radius:50%; display:flex; align-items:center; justify-content:center; margin: 0 auto 15px; font-size:30px;"><i class="fas fa-user"></i></div>
                <h3 id="p-name">--</h3>
                <p id="p-email" style="color:var(--text-sub); margin-bottom: 30px;"></p>
                <button onclick="logout()" style="color:red; background:none; border:none; font-weight:bold;">تسجيل الخروج</button>
            </div>
        </div>

        <nav class="bottom-nav">
            <div class="nav-tab active" onclick="showTab(this, 'home')"><i class="fas fa-home"></i><span>الرئيسية</span></div>
            <div class="nav-tab" onclick="showTab(this, 'lessons')"><i class="fas fa-play-circle"></i><span>الدروس</span></div>
            <div class="nav-tab" onclick="showTab(this, 'forum')"><i class="fas fa-comments"></i><span>المنتدى</span></div>
            <div class="nav-tab" onclick="showTab(this, 'profile')"><i class="fas fa-user"></i><span>حسابي</span></div>
        </nav>
    </div>

    <div id="video-overlay" class="full-overlay">
        <div id="pay-section" style="display:none; text-align:center; color:white;">
            <i class="fas fa-lock" style="font-size: 50px; color: var(--accent); margin-bottom: 20px;"></i>
            <h3>محتوى مدفوع</h3>
            <p style="margin: 15px 0;">تواصل مع م. كريم للحصول على كود التفعيل</p>
            <a href="https://wa.me/201021461421" style="color:#25D366; text-decoration:none; font-weight:900;">01021461421</a>
            <input type="text" id="act-code" class="input-glass" placeholder="أدخل كود التفعيل" style="margin-top:20px;">
            <button class="btn-accent" onclick="checkLessonCode()">تفعيل</button>
            <p onclick="closeVid()" style="margin-top:20px; opacity:0.5;">رجوع</p>
        </div>
        <div id="video-section" style="display:none; width:100%;">
            <div style="display:flex; justify-content:space-between; color:white; margin-bottom:10px;">
                <strong id="v-title">الدرس</strong><i class="fas fa-times" onclick="closeVid()"></i>
            </div>
            <video id="player" controls playsinline controlsList="nodownload"></video>
        </div>
    </div>

    <script>
        let currentUser = null;
        let pendingLesson = null;
        let completed = JSON.parse(localStorage.getItem('comp_mob_v13') || '[]');
        let unlocked = JSON.parse(localStorage.getItem('unlk_mob_v13') || '[]');

        function switchAuth(type) {
            document.getElementById('login-box').style.display = type === 'login' ? 'block' : 'none';
            document.getElementById('signup-box').style.display = type === 'signup' ? 'block' : 'none';
        }

        function checkLogin() {
            const user = localStorage.getItem('activeUser');
            if(user) {
                currentUser = JSON.parse(user);
                document.getElementById('auth-page').style.display = 'none';
                document.getElementById('app-content').style.display = 'block';
                document.getElementById('user-welcome').innerText = `أهلاً، ${currentUser.name}`;
                document.getElementById('p-name').innerText = currentUser.name;
                document.getElementById('p-email').innerText = currentUser.email;
                renderLessons(); renderPosts(); updateStats();
            }
        }

        function doLogin() {
            const email = document.getElementById('login-email').value;
            const users = JSON.parse(localStorage.getItem('codpro_users') || '[]');
            const user = users.find(u => u.email === email);
            if(user) { localStorage.setItem('activeUser', JSON.stringify(user)); checkLogin(); }
            else alert("البريد غير مسجل، يرجى إنشاء حساب");
        }

        function doSignup() {
            const name = document.getElementById('reg-name').value;
            const email = document.getElementById('reg-email').value;
            if(!name || !email) return alert("يرجى ملء كافة البيانات");
            let users = JSON.parse(localStorage.getItem('codpro_users') || '[]');
            if(users.find(u => u.email === email)) return alert("البريد مسجل مسبقاً");
            users.push({name, email});
            localStorage.setItem('codpro_users', JSON.stringify(users));
            alert("تم إنشاء الحساب بنجاح! يمكنك الدخول الآن.");
            switchAuth('login');
        }

        function renderLessons() {
            const lessons = JSON.parse(localStorage.getItem('codpro_lessons') || '[]');
            const list = document.getElementById('lesson-list');
            list.innerHTML = lessons.map(l => `
                <div class="card" onclick="openLesson('${l.id}')" style="display:flex; align-items:center; gap:15px;">
                    <div style="width:40px; height:40px; background:var(--bg); border-radius:10px; display:flex; align-items:center; justify-content:center; color:var(--primary);"><i class="fas fa-play"></i></div>
                    <div style="flex:1"><strong>${l.title}</strong></div>
                    ${l.type === 'paid' && !unlocked.includes(l.id.toString()) ? '<i class="fas fa-lock" style="color:var(--accent)"></i>' : ''}
                </div>
            `).join('');
        }

        function openLesson(id) {
            const lessons = JSON.parse(localStorage.getItem('codpro_lessons') || '[]');
            const lesson = lessons.find(l => l.id.toString() === id.toString());
            pendingLesson = lesson;
            document.getElementById('video-overlay').style.display = 'flex';
            if (lesson.type === 'paid' && !unlocked.includes(id.toString())) {
                document.getElementById('pay-section').style.display = 'block';
                document.getElementById('video-section').style.display = 'none';
            } else { startVid(); }
        }

        function checkLessonCode() {
            if(document.getElementById('act-code').value === pendingLesson.code) {
                unlocked.push(pendingLesson.id.toString());
                localStorage.setItem('unlk_mob_v13', JSON.stringify(unlocked));
                alert("تم التفعيل!"); startVid();
            } else alert("كود خاطئ!");
        }

        function startVid() {
            document.getElementById('pay-section').style.display = 'none';
            document.getElementById('video-section').style.display = 'block';
            const p = document.getElementById('player');
            p.src = pendingLesson.videoData;
            document.getElementById('v-title').innerText = pendingLesson.title;
            p.play();
            if(!completed.includes(pendingLesson.id.toString())) {
                completed.push(pendingLesson.id.toString());
                localStorage.setItem('comp_mob_v13', JSON.stringify(completed));
                updateStats(); renderLessons();
            }
        }

        function closeVid() { document.getElementById('player').pause(); document.getElementById('video-overlay').style.display = 'none'; }

        function addPost() {
            const txt = document.getElementById('post-text').value;
            if(!txt) return;
            let posts = JSON.parse(localStorage.getItem('app_posts') || '[]');
            posts.unshift({ name: currentUser.name, text: txt });
            localStorage.setItem('app_posts', JSON.stringify(posts));
            document.getElementById('post-text').value = '';
            renderPosts();
        }

        function renderPosts() {
            const posts = JSON.parse(localStorage.getItem('app_posts') || '[]');
            document.getElementById('forum-posts').innerHTML = posts.map(p => `
                <div class="card" style="margin-bottom:10px; padding:12px;"><strong>${p.name}</strong><p style="font-size:14px; opacity:0.8;">${p.text}</p></div>
            `).join('');
        }

        function updateStats() {
            const lessons = JSON.parse(localStorage.getItem('codpro_lessons') || '[]');
            document.getElementById('st-done').innerText = completed.length;
            const perc = lessons.length > 0 ? Math.round((completed.length/lessons.length)*100) : 0;
            document.getElementById('st-prog').innerText = perc + "%";
        }

        function showTab(btn, id) {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function toggleTheme() {
            const isDark = document.body.getAttribute('data-theme') === 'dark';
            document.body.setAttribute('data-theme', isDark ? 'light' : 'dark');
            document.getElementById('theme-icon').className = isDark ? 'fas fa-moon' : 'fas fa-sun';
        }
        function logout() { localStorage.removeItem('activeUser'); location.reload(); }
    </script>
</body>
</html>
